@if ((userService.userLoggedIn$ | async) === true) {
	<span class="cont">

	<form class="form" [formGroup]="historyParamForm" (ngSubmit)="onSubmit()">
	<span class="crp-container">
		<span class="category-group">
			<label>Select Crop</label>
			<app-drop-down
				[options]="DROP_DOWN_VALUE"
				formControlName="crop"
				id="crop"
				placeholder="Select Crop">
			</app-drop-down>
		</span>

		<span class="category-group">
			<label>Date Range</label>
			<div class="segmented-control">
				<button
					type="button"
					class="segment"
					*ngFor="let option of DATE_RANGES"
					[class.active]="historyParamForm.get('timeRange')?.value === option.value"
					(click)="selectTime(option.value)">
					{{ option.label }}
				</button>
			</div>
			<span class="extra-small-label">Locked options requires a premium account to have access</span>
		</span>

		<span class="sign-up-button">
			<button [disabled]="(isLoading$ | async) || (!historyParamForm.valid) || (premiumOptionSelected$ | async)" type="submit">Generate Stats</button>
		</span>
	</span>
	</form>

	@if (hasData$ | async) {
		<span>
			<span class="category-group test stats">
				<h3>Price Statistics</h3>
				<span class="price-statistics">
					<div class="price-statistic">
						<span class="medium-label-bold">{{lowestPrice$ | async}} / Kg</span>
						<label class="small-label">Lowest</label>
					</div>

					<div class="price-statistic">
						<span class="medium-label-bold">{{averagePrice$ | async | number: '1.0-0'}} / Kg</span>
						<label class="small-label">Average</label>
					</div>

					<div class="price-statistic">
						<span class="medium-label-bold">{{highestPrice$ | async}} / Kg</span>
						<label class="small-label">Highest</label>
					</div>
				</span>
			</span>
		</span>

		<div class="historic-table">
			<table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

				<!-- most common Column -->
				<ng-container matColumnDef="date">
					<th mat-header-cell *matHeaderCellDef> DATE </th>
					<td mat-cell *matCellDef="let element"> {{element.date}} </td>
				</ng-container>

				<!-- low price Column -->
				<ng-container matColumnDef="lowPrice">
					<th mat-header-cell *matHeaderCellDef> LO </th>
					<td mat-cell *matCellDef="let element"> {{element.lowPrice}} </td>
				</ng-container>

				<!-- high price Column -->
				<ng-container matColumnDef="highPrice">
					<th mat-header-cell *matHeaderCellDef> HI </th>
					<td mat-cell *matCellDef="let element"> {{element.highPrice}} </td>
				</ng-container>

				<!-- most common Column -->
				<ng-container matColumnDef="averagePrice">
					<th mat-header-cell *matHeaderCellDef> NRM </th>
					<td mat-cell *matCellDef="let element"> {{element.averagePrice}} </td>
				</ng-container>

				<!-- total sold Column -->
				<ng-container matColumnDef="totalSold">
					<th mat-header-cell *matHeaderCellDef> TTL </th>
					<td mat-cell *matCellDef="let element"> {{element.totalSold}} {{element.unitOfMeasure}} </td>
				</ng-container>

				<!-- total sold Column -->
				<ng-container matColumnDef="revenue">
					<th mat-header-cell *matHeaderCellDef> REV (Rs) </th>
					<td mat-cell *matCellDef="let element"> {{element.revenue}} </td>
				</ng-container>

				<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
				<tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
			</table>
		</div>

		<span class="charts-section">
		<span class="category-group test">
			<h3>Price trends over time</h3>
			<div class="chart">
			<canvas [data]="lineChartData" [legend]="true" [options]="lineChartOptions"
							style="background-color: #ffffff"
							[type]="'line'"
							baseChart
							height="400"
							width="400">
			</canvas>
		</div>
	</span>

		<span class="category-group test">
		<h3>Sales volume</h3>
		<div class="chart">
		<canvas [data]="barChartData" [legend]="true" [options]="barChartOptions"
						style="background-color: #ffffff"
						[type]="'bar'"
						baseChart
						height="400"
						width="400">
		</canvas>
	</div>
	</span>

		<span class="category-group test">
			<h3>Estimated Revenue Trend</h3>
			<div class="chart">
			<canvas [data]="averageRevenueChart" [legend]="true" [options]="lineChartOptions"
							style="background-color: #ffffff"
							[type]="'line'"
							baseChart
							height="400"
							width="400">
			</canvas>
			</div>
		</span>
	</span>
	}

	@if (isLoading$ | async) {
		<span class="align-spinner">
			<mat-spinner color="primary"></mat-spinner>
		</span>
	}
	</span>
} @else {
	<app-login></app-login>
}
